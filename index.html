<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ðŸŒŒ User Galaxy</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      font-family: "Segoe UI", sans-serif;
      background: radial-gradient(ellipse at center, #0d0d2b, #000);
    }

    canvas {
      position: absolute;
      width: 100vw;
      height: 100vh;
      display: block;
      z-index: 1;
    }

    .tooltip {
      position: absolute;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      color: #fff;
      padding: 6px 12px;
      border-radius: 12px;
      font-size: 13px;
      pointer-events: none;
      display: none;
      z-index: 3;
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.1);
    }

    .profile-card {
      position: absolute;
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      color: #fff;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.15);
      z-index: 4;
      display: none;
      width: 250px;
    }

    .profile-card h3 {
      margin: 0 0 10px;
      font-size: 20px;
    }

    .profile-card .joined {
      font-style: italic;
      font-size: 13px;
      color: #ccc;
    }

    .close-btn {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 18px;
      cursor: pointer;
      color: #ccc;
    }

    .close-btn:hover {
      color: #fff;
    }
  </style>
</head>
<body>
  <canvas id="galaxy"></canvas>
  <div class="tooltip" id="tooltip"></div>
  <div class="profile-card" id="profile">
    <div class="close-btn" onclick="document.getElementById('profile').style.display='none'">Ã—</div>
    <h3 id="p-username">@user</h3>
    <p class="joined" id="p-joined">Joined at: ...</p>
    <p><strong>ID:</strong> <span id="p-id"></span></p>
  </div>

  <script>
    const canvas = document.getElementById("galaxy");
    const ctx = canvas.getContext("2d");
    const tooltip = document.getElementById("tooltip");
    const profile = document.getElementById("profile");
    const pUsername = document.getElementById("p-username");
    const pJoined = document.getElementById("p-joined");
    const pId = document.getElementById("p-id");

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let stars = [];
    let zoom = 1;
    let offsetX = 0;
    let offsetY = 0;

    const monthColors = {
      0: "#ffc107", 1: "#ff8f00", 2: "#f44336", 3: "#29b6f6",
      4: "#66bb6a", 5: "#ab47bc", 6: "#fdd835", 7: "#ec407a",
      8: "#26c6da", 9: "#ff7043", 10: "#5c6bc0", 11: "#bdbdbd",
    };

    function getColorFromMonth(dateStr) {
      const month = new Date(dateStr).getMonth();
      return monthColors[month] || "#fff";
    }

    fetch("userdb.json")
      .then(res => res.json())
      .then(data => {
        const users = Object.values(data);
        const now = new Date();
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        let clusterOffset = 0;

        const grouped = {};
        users.forEach(u => {
          const d = new Date(u.joined_at);
          const key = d.getFullYear() + "-" + d.getMonth();
          if (!grouped[key]) grouped[key] = [];
          grouped[key].push(u);
        });

        Object.values(grouped).forEach((group, index) => {
          const radius = 200 + index * 160;
          const step = (Math.PI * 2) / group.length;

          group.forEach((user, i) => {
            const angle = i * step;
            const joined = new Date(user.joined_at);
            const ageDays = (now - joined) / (1000 * 60 * 60 * 24);
            const size = Math.min(5, 1 + ageDays / 90);
            const color = getColorFromMonth(user.joined_at);

            stars.push({
              baseX: centerX + Math.cos(angle) * radius,
              baseY: centerY + Math.sin(angle) * radius,
              angle,
              angleOffset: Math.random() * Math.PI * 2,
              color,
              size,
              username: user.username,
              joined_at: user.joined_at,
              id: user.id
            });
          });
        });

        animate();
      });

    function animate(time = 0) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      for (let star of stars) {
        const floatX = Math.cos(star.angle + time * 0.0003 + star.angleOffset) * 5;
        const floatY = Math.sin(star.angle + time * 0.0002 + star.angleOffset) * 5;

        const x = (star.baseX + floatX + offsetX) * zoom;
        const y = (star.baseY + floatY + offsetY) * zoom;
        const s = star.size * zoom;

        ctx.beginPath();
        ctx.arc(x, y, s, 0, Math.PI * 2);
        ctx.fillStyle = star.color;
        ctx.shadowColor = star.color;
        ctx.shadowBlur = 20;
        ctx.fill();
        ctx.shadowBlur = 0;

        star.drawX = x;
        star.drawY = y;
        star.drawSize = s;
      }

      requestAnimationFrame(animate);
    }

    canvas.addEventListener("mousemove", e => {
      for (let star of stars) {
        const dx = e.clientX - star.drawX;
        const dy = e.clientY - star.drawY;
        const dist = dx * dx + dy * dy;
        if (dist < (star.drawSize + 6) ** 2) {
          tooltip.style.left = `${e.clientX + 10}px`;
          tooltip.style.top = `${e.clientY + 10}px`;
          tooltip.innerText = `@${star.username}`;
          tooltip.style.display = "block";
          return;
        }
      }
      tooltip.style.display = "none";
    });

    canvas.addEventListener("click", e => {
      for (let star of stars) {
        const dx = e.clientX - star.drawX;
        const dy = e.clientY - star.drawY;
        const dist = dx * dx + dy * dy;
        if (dist < (star.drawSize + 6) ** 2) {
          profile.style.left = `${e.clientX + 15}px`;
          profile.style.top = `${e.clientY + 15}px`;
          profile.style.display = "block";
          pUsername.textContent = `@${star.username}`;
          pJoined.textContent = `Joined at: ${new Date(star.joined_at).toLocaleString()}`;
          pId.textContent = star.id;
          return;
        }
      }
      profile.style.display = "none";
    });

    canvas.addEventListener("wheel", e => {
      e.preventDefault();
      const scale = e.deltaY < 0 ? 1.1 : 0.9;
      zoom *= scale;
      zoom = Math.max(0.3, Math.min(3.5, zoom));
    }, { passive: false });

    window.addEventListener("resize", () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    });
  </script>
</body>
</html>
